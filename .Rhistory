spread(disp,Dispositions,fill = 0) %>%
ungroup()
Desc(d$disp)
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
#`ACD/M Dismissal (%)` = `ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`30.30 Speedy (%)` = `30.30 Speedy`/rowSums(.[,2:ncol(.)]),
#`Evidence Dismissal (%)` = `Evidence Dismissal`/rowSums(.[,2:ncol(.)]),
#`Other Non ACD/M Dismissal (%)` = `Other Non ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`Acquitted (%)` = `Acquitted`/rowSums(.[,2:ncol(.)]),
#`Other (%)` = `Other`/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
#`ACD/M Dismissal (%)` = `ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`30.30 Speedy (%)` = `30.30 Speedy`/rowSums(.[,2:ncol(.)]),
#`Evidence Dismissal (%)` = `Evidence Dismissal`/rowSums(.[,2:ncol(.)]),
#`Other Non ACD/M Dismissal (%)` = `Other Non ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`Acquitted (%)` = `Acquitted`/rowSums(.[,2:ncol(.)]),
#`Other (%)` = `Other`/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Not Guilty (%)` = `Verdict-Not Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
#`ACD/M Dismissal (%)` = `ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`30.30 Speedy (%)` = `30.30 Speedy`/rowSums(.[,2:ncol(.)]),
#`Evidence Dismissal (%)` = `Evidence Dismissal`/rowSums(.[,2:ncol(.)]),
#`Other Non ACD/M Dismissal (%)` = `Other Non ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`Acquitted (%)` = `Acquitted`/rowSums(.[,2:ncol(.)]),
#`Other (%)` = `Other`/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Not Guilty (%)` = `Verdict-Not Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
#`ACD/M Dismissal (%)` = `ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`30.30 Speedy (%)` = `30.30 Speedy`/rowSums(.[,2:ncol(.)]),
#`Evidence Dismissal (%)` = `Evidence Dismissal`/rowSums(.[,2:ncol(.)]),
#`Other Non ACD/M Dismissal (%)` = `Other Non ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`Acquitted (%)` = `Acquitted`/rowSums(.[,2:ncol(.)]),
#`Other (%)` = `Other`/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))  %>%
select(arrest_year,
`Plea`,`Plea (%)`,
`Verdict Guilty`,`Verdict Guilty (%)`,
FNPC, `No P.C. (%)`)
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Not Guilty (%)` = `Verdict-Not Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
#`ACD/M Dismissal (%)` = `ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`30.30 Speedy (%)` = `30.30 Speedy`/rowSums(.[,2:ncol(.)]),
#`Evidence Dismissal (%)` = `Evidence Dismissal`/rowSums(.[,2:ncol(.)]),
#`Other Non ACD/M Dismissal (%)` = `Other Non ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`Acquitted (%)` = `Acquitted`/rowSums(.[,2:ncol(.)]),
#`Other (%)` = `Other`/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))  %>%
select(arrest_year,
`Plea Of Guilty`,`Plea (%)`,
`Verdict Guilty`,`Verdict Guilty (%)`,
FNPC, `No P.C. (%)`)
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Not Guilty (%)` = `Verdict-Not Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
#`ACD/M Dismissal (%)` = `ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`30.30 Speedy (%)` = `30.30 Speedy`/rowSums(.[,2:ncol(.)]),
#`Evidence Dismissal (%)` = `Evidence Dismissal`/rowSums(.[,2:ncol(.)]),
#`Other Non ACD/M Dismissal (%)` = `Other Non ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`Acquitted (%)` = `Acquitted`/rowSums(.[,2:ncol(.)]),
#`Other (%)` = `Other`/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))  %>%
select(arrest_year,
`Plea Of Guilty`,`Plea (%)`,
`Verdict Guilty`,`Verdict Guilty (%)`,
FNPC, `No P.C. (%)`,
`Verdict Not Guilty`,`Verdict Not Guilty (%)`,
Disposed)
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Not Guilty (%)` = `Verdict-Not Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
#`ACD/M Dismissal (%)` = `ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`30.30 Speedy (%)` = `30.30 Speedy`/rowSums(.[,2:ncol(.)]),
#`Evidence Dismissal (%)` = `Evidence Dismissal`/rowSums(.[,2:ncol(.)]),
#`Other Non ACD/M Dismissal (%)` = `Other Non ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`Acquitted (%)` = `Acquitted`/rowSums(.[,2:ncol(.)]),
#`Other (%)` = `Other`/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))  %>%
select(arrest_year,
`Plea Of Guilty`,`Plea (%)`,
`Verdict Guilty`,`Verdict Guilty (%)`,
FNPC, `No P.C. (%)`,
`Verdict-Not Guilty`,`Verdict Not Guilty (%)`,
Disposed)
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Not Guilty (%)` = `Verdict-Not Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
#`ACD/M Dismissal (%)` = `ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`30.30 Speedy (%)` = `30.30 Speedy`/rowSums(.[,2:ncol(.)]),
#`Evidence Dismissal (%)` = `Evidence Dismissal`/rowSums(.[,2:ncol(.)]),
#`Other Non ACD/M Dismissal (%)` = `Other Non ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`Acquitted (%)` = `Acquitted`/rowSums(.[,2:ncol(.)]),
#`Other (%)` = `Other`/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))  %>%
select(arrest_year,
`Plea Of Guilty`,`Plea (%)`,
`Verdict Guilty`,`Verdict Guilty (%)`,
FNPC, `No P.C. (%)`,
`Verdict-Not Guilty`,`Verdict Not Guilty (%)`,
Disposed) %>%
t() %>%
as.data.frame() %>%
as_tibble() %>%
rownames_to_column(var = " ") %>%
set_names(.[1,-1] %>% unlist() %>% as.numeric() %>% as.character() %>% c(" ",.)) %>%
filter(` `!="ScreenYear") %>%
mutate_at(vars(-1),as.numeric) %>%
mutate(Total = case_when(grepl("%",` `)==T ~
lag(rowSums(.[,2:ncol(.)]))/
rowSums(.[nrow(.),2:ncol(.)]),
TRUE ~
rowSums(.[,2:ncol(.)]))) %>%
mutate_at(vars(-1),funs(ifelse(grepl("%",` `)==T,paste0(round(100*.,1),"%"),comma(.,digits = 0))))
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Not Guilty (%)` = `Verdict-Not Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
#`ACD/M Dismissal (%)` = `ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`30.30 Speedy (%)` = `30.30 Speedy`/rowSums(.[,2:ncol(.)]),
#`Evidence Dismissal (%)` = `Evidence Dismissal`/rowSums(.[,2:ncol(.)]),
#`Other Non ACD/M Dismissal (%)` = `Other Non ACD/M Dismissal`/rowSums(.[,2:ncol(.)]),
#`Acquitted (%)` = `Acquitted`/rowSums(.[,2:ncol(.)]),
#`Other (%)` = `Other`/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))  %>%
select(arrest_year,
`Plea Of Guilty`,`Plea (%)`,
`Verdict Guilty`,`Verdict Guilty (%)`,
FNPC, `No P.C. (%)`,
`Verdict-Not Guilty`,`Verdict Not Guilty (%)`,
Disposed) %>%
t() %>%
as.data.frame() %>%
#as_tibble() %>%
rownames_to_column(var = " ") %>%
set_names(.[1,-1] %>% unlist() %>% as.numeric() %>% as.character() %>% c(" ",.)) %>%
filter(` `!="ScreenYear") %>%
mutate_at(vars(-1),as.numeric) %>%
mutate(Total = case_when(grepl("%",` `)==T ~
lag(rowSums(.[,2:ncol(.)]))/
rowSums(.[nrow(.),2:ncol(.)]),
TRUE ~
rowSums(.[,2:ncol(.)]))) %>%
mutate_at(vars(-1),funs(ifelse(grepl("%",` `)==T,paste0(round(100*.,1),"%"),comma(.,digits = 0))))
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Not Guilty (%)` = `Verdict-Not Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))  %>%
select(arrest_year,
`Plea Of Guilty`,`Plea (%)`,
`Verdict Guilty`,`Verdict Guilty (%)`,
FNPC, `No P.C. (%)`,
`Verdict-Not Guilty`,`Verdict Not Guilty (%)`,
Disposed) %>%
t() %>%
as.data.frame() %>%
#as_tibble() %>%
rownames_to_column(var = " ")
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Not Guilty (%)` = `Verdict-Not Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))  %>%
select(arrest_year,
`Plea Of Guilty`,`Plea (%)`,
`Verdict Guilty`,`Verdict Guilty (%)`,
FNPC, `No P.C. (%)`,
`Verdict-Not Guilty`,`Verdict Not Guilty (%)`,
Disposed) %>%
t() %>%
as.data.frame() %>%
#as_tibble() %>%
rownames_to_column(var = " ") %>%
set_names(.[1,-1] %>% unlist() %>% as.numeric() %>% as.character() %>% c(" ",.))
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Not Guilty (%)` = `Verdict-Not Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))  %>%
select(arrest_year,
`Plea Of Guilty`,`Plea (%)`,
`Verdict Guilty`,`Verdict Guilty (%)`,
FNPC, `No P.C. (%)`,
`Verdict-Not Guilty`,`Verdict Not Guilty (%)`,
Disposed) %>%
t() %>%
as.data.frame() %>%
#as_tibble() %>%
rownames_to_column(var = " ") %>%
set_names(.[1,-1] %>% unlist() %>% as.numeric() %>% as.character() %>% c(" ",.)) %>%
filter(` `!="arrest_year")
d %>%
filter(disposed.x==1) %>%
group_by(arrest_year,disp) %>%
summarise(Dispositions = n()) %>%
spread(disp,Dispositions,fill = 0) %>%
ungroup() %>%
mutate(`Nolle Pros. (%)` = `Nolle Prosecution`/rowSums(.[,2:ncol(.)]),
`Plea (%)` = `Plea Of Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Guilty (%)` = `Verdict Guilty`/rowSums(.[,2:ncol(.)]),
`Verdict Not Guilty (%)` = `Verdict-Not Guilty`/rowSums(.[,2:ncol(.)]),
`No P.C. (%)` = FNPC/rowSums(.[,2:ncol(.)]),
Disposed = rowSums(.[,2:ncol(.)]))  %>%
select(arrest_year,
`Plea Of Guilty`,`Plea (%)`,
`Verdict Guilty`,`Verdict Guilty (%)`,
FNPC, `No P.C. (%)`,
`Verdict-Not Guilty`,`Verdict Not Guilty (%)`,
Disposed) %>%
t() %>%
as.data.frame() %>%
#as_tibble() %>%
rownames_to_column(var = " ") %>%
set_names(.[1,-1] %>% unlist() %>% as.numeric() %>% as.character() %>% c(" ",.)) %>%
filter(` `!="arrest_year") %>%
mutate_at(vars(-1),as.numeric) %>%
mutate(Total = case_when(grepl("%",` `)==T ~
lag(rowSums(.[,2:ncol(.)]))/
rowSums(.[nrow(.),2:ncol(.)]),
TRUE ~
rowSums(.[,2:ncol(.)]))) %>%
mutate_at(vars(-1),funs(ifelse(grepl("%",` `)==T,paste0(round(100*.,1),"%"),comma(.,digits = 0))))
kable(dsp,format = "latex",booktabs = T,
align = c("l",rep("c",ncol(dsp))),digits = 0,
format.args = list(big.mark = ","),linesep = "",
caption = "Prostitution Dispositions, 2010 - 2017")
pkgs <- c("shinydashboard", "leaflet", "tidyr", "DT"
"tidyverse", "here", "DescTools", "skimr",
"lubridate", "sjmisc", "tictoc", "purrr",
"xtable", "ggalt", "knitr", "kableExtra", "janitor",
"scales", "Cairo", "dplyr", "feather")
pkgs <- c("shinydashboard", "leaflet", "tidyr", "DT",
"tidyverse", "here", "DescTools", "skimr",
"lubridate", "sjmisc", "tictoc", "purrr",
"xtable", "ggalt", "knitr", "kableExtra", "janitor",
"scales", "Cairo", "dplyr", "feather")
options(scipen=1000)
lapply(pkgs, require, character.only = T)
pkgs <- c("shinydashboard", "tidyr", "DT",
"tidyverse", "here", "DescTools", "skimr",
"lubridate", "sjmisc", "tictoc", "purrr",
"xtable", "ggalt", "knitr", "kableExtra", "janitor",
"scales", "Cairo", "dplyr", "feather")
options(scipen=1000)
lapply(pkgs, require, character.only = T)
shiny::runApp('~/CookCo/Output/Dashboard')
runApp('~/CookCo/Output/Dashboard')
pkgs <- c("tidyverse", "here", "DescTools", "skimr",
"lubridate", "sjmisc", "tictoc", "feather")
options(scipen=1000)
lapply(pkgs, require, character.only = T)
##Intake - all people arrested
int <- here::here("data", "intake.csv")
int <- read.csv(int)
###Intake
int2 <- int %>%
mutate(ARREST_DATE = mdy_hms(ARREST_DATE),
arrest_year = as.character(year(ARREST_DATE))) %>%
filter(ARREST_DATE <= today(),arrest_year >= 2012) %>%
dplyr::select(CASE_PARTICIPANT_ID,
Offense_Category,
PARTICIPANT_STATUS,
ARREST_DATE,
arrest_year,
Offense_Category,
AGE_AT_INCIDENT,
GENDER,
RACE,
LAW_ENFORCEMENT_AGENCY
)
filename <- here::here("data", "clean", "intake.feather")
write_feather(int2, filename)
rm(list=ls())
pkgs <- c("tidyverse", "here", "DescTools", "skimr",
"lubridate", "sjmisc", "tictoc", "feather")
options(scipen=1000)
#Report: https://www.cookcountystatesattorney.org/sites/default/files/files/documents/ccsao_2017_data_report_180220.pdf
lapply(pkgs, require, character.only = T)
##Initiation - all people charged
init <- here::here("data", "initiation.csv")
i <- read.csv(init)
###Initiation
i2 <- i %>%
dplyr::filter(PRIMARY_CHARGE == "true") %>%
mutate(EVENT_DATE = mdy_hms(EVENT_DATE),
event_year = as.character(year(EVENT_DATE))) %>%
filter(EVENT_DATE <= today(),event_year >= 2012) %>%
dplyr::select(CASE_PARTICIPANT_ID,
OFFENSE_TITLE,
EVENT,
EVENT_DATE,
event_year
)
filename <- here::here("data", "clean", "initiation.feather")
write_feather(i2, filename)
rm(list=ls())
pkgs <- c("tidyverse", "here", "DescTools", "skimr",
"lubridate", "sjmisc", "tictoc", "feather")
options(scipen=1000)
#Report: https://www.cookcountystatesattorney.org/sites/default/files/files/documents/ccsao_2017_data_report_180220.pdf
lapply(pkgs, require, character.only = T)
##Dispositions
disp <- here::here("data", "dispositions.csv")
d <- read.csv(disp)
###Dispositions
d2 <- d %>%
mutate(class_order = case_when(CLASS == "X" ~ 1,
CLASS == "1" ~ 2,
CLASS == "2" ~ 3,
CLASS == "3" ~ 4,
CLASS == "4" ~ 5,
TRUE ~ 9),
disp = forcats::fct_lump(CHARGE_DISPOSITION, prop = .005),
disposed = 1,
gbp = case_when(disp %in% c("Plea Of Guilty", "Finding Guilty", "Verdict Guilty") ~ 1,
TRUE ~ 0),
race2 = case_when(RACE %in% c("Asian", "ASIAN") ~ "Asian",
RACE %in% c("Black") ~ "Black",
RACE %in% c("White", "CAUCASIAN") ~ "White",
RACE %in% c("HISPANIC", "White [Hispanic or Latino]", "White/Black [Hispanic or Latino]") ~ "Latino",
TRUE ~ "Other")
) %>%
dplyr::select(CASE_PARTICIPANT_ID,
race2,
PRIMARY_CHARGE,
disposed,
disp,
gbp,
CHARGE_DISPOSITION,
CHARGE_DISPOSITION_REASON,
JUDGE,
OFFENSE_TITLE,
CLASS,
class_order)
d3 <- d2 %>%
group_by(CASE_PARTICIPANT_ID) %>%
arrange(class_order) %>%
filter(row_number()==1)
###Guilty Charges
gbp <- d2 %>%
filter(gbp == 1) %>%
select(-race2) %>%
rename(gbp_disp = disp)
gbp2 <- gbp %>%
group_by(CASE_PARTICIPANT_ID) %>%
arrange(class_order) %>%
filter(row_number()==1)
filename <- here::here("data", "clean", "dispositions.feather")
write_feather(d2, filename)
filename <- here::here("data", "clean", "gbp.feather")
write_feather(gbp2, filename)
rm(list=ls())
pkgs <- c("tidyverse", "here", "DescTools", "skimr",
"lubridate", "sjmisc", "tictoc", "feather")
options(scipen=1000)
#Report: https://www.cookcountystatesattorney.org/sites/default/files/files/documents/ccsao_2017_data_report_180220.pdf
lapply(pkgs, require, character.only = T)
##Sentencing
sen <- here::here("data","sentencing.csv")
s <- read.csv(sen)
###Sentences
s2 <- s %>%
filter(SENTENCE_PHASE == "Original Sentencing",
PRIMARY_CHARGE == "true") %>%
mutate(class_order = case_when(CLASS == "X" ~ 1,
CLASS == "1" ~ 2,
CLASS == "2" ~ 3,
CLASS == "3" ~ 4,
CLASS == "4" ~ 5,
TRUE ~ 9),
sentenced = 1
) %>%
select(CASE_PARTICIPANT_ID,
CLASS,
class_order,
SENTENCE_TYPE,
COMMITMENT_TYPE,
COMMITMENT_TERM,
COMMITMENT_UNIT,
LENGTH_OF_CASE_in_Days
) %>%
group_by(CASE_PARTICIPANT_ID) %>%
arrange(class_order) %>%
filter(row_number()==1)
filename <- here::here("data", "clean", "sentences.feather")
write_feather(s2, filename)
rm(list=ls())
here::here()
file.sources = list.files(pattern="*.R")
file.sources = list.files("scripts", pattern="*.r")
here::here()
file.sources = list.files("scripts", pattern="*.r")
sapply(file.sources, source)
dir <- here::here("scripts")
file.sources = list.files(dir, pattern="*.r")
sapply(file.sources, source)
setwd(dir)
sapply(file.sources, source)
file.sources
file.sources = list.files(dir, pattern="*.r")
here::here()
dir <- here::here("scripts")
file.sources = list.files(dir, pattern="*.r")
file.sources
file.sources[-2]
here::here()
dir <- here::here("scripts")
file.sources = list.files(dir, pattern="*.r")
setwd(dir)
sapply(file.sources[-2], source)
setwd('/home/connor/CookCo/scripts')
file.sources = list.files(getwd(), pattern="*.r")
print(file.sources)
